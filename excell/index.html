
<html>
	<head>
		<script type="text/javascript" src="http://underscorejs.org/underscore.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
		<script type="text/javascript" src="scripts/functions.js"></script>
		<link rel="stylesheet" type="text/css" href="main.css">

		<script type="text/javascript">
			// Set parameters
			function loadArray(){
				myArray = new Array();
				myArray[0] = 76000;
				myArray[1] = 5000;
				myArray[2] = 45000;
				myArray[3] = 11750;
				myArray[4] = 120000;
				myArray[5] = 10000;
				myArray[6] = 15750; 
				return myArray; 
			}

			var targetTotal = 126000;


			// Begin Code
			var columns = {0:'.cash',1:'.acounts_receivable',2:'.equipment',3:'.accounts_payable',4:'.commons_stock',5:'.revenue',6:'.expenses'};
			var num_rows = 1;
			$(function (){
				$('.beg_balance .cash').html('50000');
				$('.beg_balance .acounts_receivable').html('20000');
				$('.beg_balance .equipment').html('10000');
				$('.beg_balance .accounts_payable').html('10000');
				$('.beg_balance .commons_stock').html('70000');
				$('.beg_balance .revenue').html('0');
				$('.beg_balance .expenses').html('0');
				$('.row:last .add_row').html('<button id="add_row_btn" onClick="javascript:add_row();">Add a row</button>');

				$('input').live("focusout", function(){
					calculations();
				});

			})
			function add_row(){
				num_rows++;
				$('#calculations').append(function(){
					var html = $('#calculations .row:first').html();
					return '<div id="'+ num_rows +'" class="row">'+ html +'</div>';
				});
				$('.add_row').html('&nbsp;');
				$('.row:last .add_row').html('<button id="add_row_btn" onClick="javascript:add_row();">Add a row</button>');
				$('.row div.add_row').append(function(){
					return '<span class="num">'+ $(this).parent().attr('id') + '</span>';
				});


			}
			$(window).bind('beforeunload', function(){
				return 'Leaving this page will wipe all your data.';
			})
			function addCol(column) {
				rowTotal = parseFloat($('.beg_balance ' +column).html());
				$('.row '+ column +' input').each(function(){
					var value = parseFloat($(this).val())
					if(value){
						rowTotal += parseFloat($(this).val());
					}
				});
			    $('.last_row ' + column).html(rowTotal);
			    return rowTotal;
			}

			function calculations(){

				var eColumnVal = loadArray();
				
				var values = new Array();
				$.each(columns,function(i,n){
					values[i] = parseFloat(addCol(n));
					if(values[i] == eColumnVal[i]) {
						$('.last_row ' + n).removeClass('bad');
						$('.last_row ' + n).addClass('good');
					} else {
						$('.last_row ' + n).removeClass('good');
						$('.last_row ' + n).addClass('bad');

					}
				})

				var totalLeft = values[0] + values[1] + values[2];
				var totalRight = values[3] + values[4] + values[5] - values[6];
				$('.last_row_totals .total_left').html(totalLeft);
				$('.last_row_totals .total_right').html(totalRight);
				if(totalLeft == targetTotal && totalLeft == totalRight) {
					$('.last_row_totals .total_left').removeClass('bad');
					$('.last_row_totals .total_left').addClass('good');
				} else {
					$('.last_row_totals .total_left').removeClass('good');
					$('.last_row_totals .total_left').addClass('bad');
				}
				if(totalRight == targetTotal && totalLeft == totalRight) {
					$('.last_row_totals .total_right').removeClass('bad');
					$('.last_row_totals .total_right').addClass('good');
				} else {
					$('.last_row_totals .total_right').removeClass('good');
					$('.last_row_totals .total_right').addClass('bad');
				}
				$('.sign').css('display','block');

			}	
		</script>

	</head>
	<body>
		<div id="wrapper">
			<div id="calculations">
				<div id="legends">
					<div class="title" >Cash</div>
					<div class="title">Accounts Receivable</div>
					<div class="title">Equipment</div>
					<div class="title">Accounts Payable</div>
					<div class="title">Common Stock</div>
					<div class="title">Revenue</div>
					<div class="title">Expenses</div>
				</div>
				<div class="beg_balance">
					<div class="beg_balance_title">Begining Balance:</div>
					<div class="cash" ></div>
					<div class="acounts_receivable"></div>
					<div class="equipment"></div>
					<div class="accounts_payable"></div>
					<div class="commons_stock"></div>
					<div class="revenue"></div>
					<div class="expenses"></div>
				</div>

				<div id="1" class="row">
					<div class="add_row"></div>
					<div class="cash"><input type="text"></div>
					<div class="acounts_receivable"><input type="text"></div>
					<div class="equipment"><input type="text"></div>
					<div class="accounts_payable"><input type="text"></div>
					<div class="commons_stock"><input type="text"></div>
					<div class="revenue"><input type="text"></div>
					<div class="expenses"><input type="text"></div>
				</div>
			</div>
			<div class ="last_row">
				<div class="last_row_title">&nbsp;</div>  
				<div class="cash"></div> <div class="sign">+</div> 
				<div class="acounts_receivable"></div> <div class="sign">+</div>
				<div class="equipment"></div> <div class="sign">=</div>
				<div class="accounts_payable"></div> <div class="sign">+</div>
				<div class="commons_stock"></div> <div class="sign">+</div>
				<div class="revenue"></div> <div class="sign">-</div>
				<div class="expenses"></div>
			</div>
			<div class ="last_row_totals">
				<span class="total_left"></span> = 
				<span class="total_right"></span>
			</div>
		</div>
	</body>
</html>